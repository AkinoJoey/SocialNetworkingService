document.addEventListener("DOMContentLoaded",(function(){let e;window.scrollTo(0,document.body.scrollHeight),e=new WebSocket("wss://ten.yuki-gakiya.com/chat"),e.onopen=function(t){let n={type:"join",dm_thread_id:dmThreadId,sender_user_id:senderUserId,receiver_user_id:receiverUserId};e.send(JSON.stringify(n))};const t=document.getElementById("chat_container");e.onmessage=function(e){let n=JSON.parse(e.data);"success"===n.status&&(t.innerHTML+=`\n            <div class="chat chat-start">\n                    <div class="avatar chat-image">\n                        <div class="w-10 rounded-full">\n                            <img alt="Tailwind CSS chat bubble component" src="${receiverUserProfileImagePath}" />\n                        </div>\n                    </div>\n                    <div class="chat-header">\n                        ${receiverUserAccountName}\n                        <time class="text-xs opacity-50">12:45</time>\n                    </div>\n                    <div class="chat-bubble text-black bg-gray-300 dark:bg-gray-700">${n.message}</div>\n                    <div class="chat-footer opacity-50">Delivered</div>\n            </div>\n            `,window.scrollTo(0,document.body.scrollHeight)),"error"===n.status&&alert(n.message)},e.onerror=function(){alert("エラーが発生しました"),window.location.reload()},document.getElementById("submit_btn").addEventListener("click",(function(e){e.preventDefault(),a()}));let n=document.getElementById("message");function a(){if(""!==n.value)if(n.value.length>140||""===n.value.trim())alert("1文字以上140文字以内のテキストのみ送信可能です");else{let a={type:"message",dm_thread_id:dmThreadId,sender_user_id:senderUserId,receiver_user_id:receiverUserId,message:n.value};e.send(JSON.stringify(a));let i=function(e){return e.replace(/(?:\r\n|\r|\n)/g,"<br>")}(n.value.replace(/(\r\n|\r|\n){3,}/g,"\n\n").replace(/[&<>'"]/g,(function(e){return{"&":"&amp;","<":"&lt;",">":"&gt;","'":"&#39;",'"':"&quot;"}[e]})));t.innerHTML+=`\n            <div class="chat chat-end">\n                <div class="avatar chat-image">\n                    <div class="w-10 rounded-full">\n                        <img alt="Tailwind CSS chat bubble component" src="${senderUserProfileImagePath}" />\n                    </div>\n                </div>\n                <div class="chat-header">\n                    ${senderUserAccountName}\n                </div>\n                <div class="chat-bubble text-white bg-blue-400">${i}</div>\n                <div class="chat-footer opacity-50">${(new Date).toLocaleDateString("ja-JP",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"})}</div>\n            </div>\n            `,n.value="",window.scrollTo(0,document.body.scrollHeight)}}n.focus(),n.addEventListener("keydown",(function(e){"Enter"===e.key&&e.shiftKey&&(e.preventDefault(),a())}))}));