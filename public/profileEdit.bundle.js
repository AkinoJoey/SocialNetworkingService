(()=>{"use strict";function e(e,t){e.classList.toggle("hidden"),t.classList.toggle("hidden")}document.addEventListener("DOMContentLoaded",(function(){let t=document.getElementById("file-input"),n=document.getElementById("user_portrait");n.addEventListener("click",(function(){t.click()})),t.addEventListener("change",(function(e){let t=e.target.files[0],i=new FileReader;i.onload=function(e){n.src=e.target.result},i.readAsDataURL(t)}));let i=document.getElementById("profile-update"),a=document.getElementById("loading-profile-update"),d=document.getElementById("profile_form");d.addEventListener("submit",(function(n){n.preventDefault();let l=new FormData(d);if(null!=t.files[0]){if(o=t.files[0],!(["image/png","image/jpeg","image/jpg","image/webp"].includes(o.type)&&5242880>o.size||(alert("メディアはjpg, png, webp形式のみ対応しています"),0)))return;l.append("media",t.files[0])}var o;e(i,a),fetch("/form/profile/edit",{method:"POST",body:l}).then((e=>e.json())).then((t=>{"success"===t.status?window.location.href=`/profile?username=${t.newUsername}`:"error"===t.status&&(e(i,a),alert(t.message))})).catch((t=>{e(i,a),alert("エラーが発生しました")}))}))}))})();