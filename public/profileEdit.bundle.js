(()=>{"use strict";function e(e,t){e.classList.toggle("hidden"),t.classList.toggle("hidden")}document.addEventListener("DOMContentLoaded",(function(){let t=document.getElementById("file-input"),n=document.getElementById("user_portrait");n.addEventListener("click",(function(){t.click()})),t.addEventListener("change",(function(e){let t=e.target.files[0],d=new FileReader;d.onload=function(e){n.src=e.target.result},d.readAsDataURL(t)}));let d=document.getElementById("profile-update"),i=document.getElementById("loading-profile-update"),o=document.getElementById("profile_form");o.addEventListener("submit",(function(n){n.preventDefault();let l=new FormData(o);null!=t.files[0]&&l.append("media",t.files[0]),e(d,i),fetch("/form/profile/edit",{method:"POST",body:l}).then((e=>e.json())).then((t=>{"success"===t.status?window.location.href=`/profile?username=${t.newUsername}`:"error"===t.status&&(e(d,i),alert(t.message))})).catch((t=>{e(d,i),alert("エラーが発生しました")}))}))}))})();